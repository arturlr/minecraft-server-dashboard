input AddUserToServerInput {
	instanceId: String!
	userEmail: AWSEmail!
}

# New enum for membership roles
enum MembershipRole {
	admin
	moderator
	viewer
}

# New type for user membership
type UserMembership @aws_iam @aws_cognito_user_pools {
	userId: String!
	serverId: String!
	email: AWSEmail!
	role: MembershipRole!
	createdAt: AWSDateTime!
	updatedAt: AWSDateTime!
	createdBy: AWSEmail!
}

input UserMembershipInput {
	userId: String!
	serverId: String!
	email: AWSEmail!
	role: MembershipRole!
	createdBy: AWSEmail!
}

input UpdateUserRoleInput {
	userId: String!
	serverId: String!
	role: MembershipRole!
}

input CreateServerInput {
	serverName: String!
	instanceType: String!
	alarmThreshold: Float
	alarmEvaluationPeriod: Int
	startScheduleExpression: String
	stopScheduleExpression: String
}

type LogAudit @aws_iam
@aws_cognito_user_pools {
	id: ID!
	actionUser: AWSEmail!
	action: String!
	instanceId: String!
	inviteeEmail: AWSEmail	
	expirationEpoch: AWSTimestamp
	createdAt: AWSDateTime
}

type ServerLogs @aws_iam
@aws_cognito_user_pools {
	success: Boolean!
	logs: String
	error: String
	instanceId: String
}

input LogAuditInput {
	id: ID!
	actionUser: AWSEmail!
	action: String!
	instanceId: String!
	inviteeEmail: AWSEmail	
	expirationEpoch: AWSTimestamp
	createdAt: AWSDateTime
}

type MonthlyCost @aws_iam
@aws_cognito_user_pools {
	id: String!
	timePeriod: String!
	UnblendedCost: Float!
	UsageQuantity: Float!
}

input MonthlyCostInput {
	id: String!
	timePeriod: String
	UnblendedCost: Float
	UsageQuantity: Float
}

input ec2ActionValidatorInput {
	action: String!
	instanceId: String!
	params: AWSJSON
}

type ServerConfig @aws_iam
@aws_cognito_user_pools {
	id: String!
	stopScheduleExpression: String
	startScheduleExpression: String
	alarmThreshold: Float
	alarmEvaluationPeriod: Int
	runCommand: String
	workDir: String
	timezone: String
	scriptVersion: String
	isBootstrapComplete: Boolean
	bootstrapStage: String
	bootstrapStatus: String
	bootstrapError: String
	hasCognitoGroup: Boolean
	minecraftVersion: String
	latestPatchUpdate: String
	createdAt: AWSDateTime
	updatedAt: AWSDateTime
	autoConfigured: Boolean
	runningMinutesCache: Float
	runningMinutesCacheTimestamp: AWSDateTime
}

input ServerConfigInput {
	id: String!
	stopScheduleExpression: String
	startScheduleExpression: String
	alarmThreshold: Float
	alarmEvaluationPeriod: Int
	runCommand: String
	workDir: String
	timezone: String
	scriptVersion: String
	isBootstrapComplete: Boolean
	bootstrapStage: String
	bootstrapStatus: String
	bootstrapError: String
	hasCognitoGroup: Boolean
	minecraftVersion: String
	latestPatchUpdate: String
	createdAt: AWSDateTime
	updatedAt: AWSDateTime
	autoConfigured: Boolean
	runningMinutesCache: Float
	runningMinutesCacheTimestamp: AWSDateTime
}

type ServerUsers @aws_iam
@aws_cognito_user_pools {
	id: String!
	email: AWSEmail!
	fullName: String!
	role: MembershipRole!
}

input ServerUsersInput {
	id: String!
	email: AWSEmail!
	fullName: String!
	role: MembershipRole!
}

type ServerInfo @aws_iam
@aws_cognito_user_pools {
	id: String!
	name: String
	type: String
	userEmail: AWSEmail
	state: String
	vCpus: Int
	memSize: Int
	diskSize: Int
	launchTime: String
	publicIp: String
	initStatus: String
	iamStatus: String
	runningMinutes: String
	runningMinutesCacheTimestamp: String
	configStatus: String
	configValid: Boolean
	configWarnings: [String]
	configErrors: [String]
	autoConfigured: Boolean
}

input ServerInfoInput {
	id: String!
	name: String
	type: String
	userEmail: AWSEmail
	state: String
	vCpus: Int
	memSize: Int
	diskSize: Int
	launchTime: String
	publicIp: String
	initStatus: String
	iamStatus: String
	runningMinutes: String
	runningMinutesCacheTimestamp: String
	configStatus: String
	configValid: Boolean
	configWarnings: [String]
	configErrors: [String]
	autoConfigured: Boolean
}

type ServerMetric @aws_iam
@aws_cognito_user_pools {
	id: String!
	cpuStats: AWSJSON
	networkStats: AWSJSON
	memStats: AWSJSON
	activeUsers: AWSJSON
}

input ServerMetricInput {
	id: String!
	cpuStats: AWSJSON
	networkStats: AWSJSON
	memStats: AWSJSON
	activeUsers: AWSJSON
}

# New type for server action status
type ec2ActionValidatorStatus @aws_iam
@aws_cognito_user_pools {
	id: String!
	action: String!
	status: String!
	timestamp: AWSTimestamp!
	message: String
	userEmail: AWSEmail
}

input ec2ActionValidatorStatusInput {
	id: String!
	action: String!
	status: String!
	timestamp: AWSTimestamp!
	message: String
	userEmail: AWSEmail
}

type Mutation {
	putServerMetric(input: ServerMetricInput!): ServerMetric
		@aws_iam @aws_cognito_user_pools
	changeServerState(input: ServerInfoInput!): ServerInfo
		@aws_iam
	
	putec2ActionValidatorStatus(input: ec2ActionValidatorStatusInput!): ec2ActionValidatorStatus
		@aws_iam @aws_cognito_user_pools
	startServer(instanceId: String!): AWSJSON
		@aws_cognito_user_pools
	restartServer(instanceId: String!): AWSJSON
		@aws_cognito_user_pools
	stopServer(instanceId: String!): AWSJSON
		@aws_cognito_user_pools
	bootstrapServer(instanceId: String!): AWSJSON
		@aws_cognito_user_pools
	iamProfileManager(instanceId: String!): AWSJSON
		@aws_cognito_user_pools  
	verifyUserEmail(id: String!): AWSJSON
		@aws_cognito_user_pools
	addUserToServer(userEmail: AWSEmail, instanceId: String!): AWSJSON
		@aws_cognito_user_pools
	putServerConfig(input: ServerConfigInput!): ServerConfig  
		@aws_cognito_user_pools
	updateServerConfig(input: ServerConfigInput!): ServerConfig
		@aws_cognito_user_pools 
	updateServerName(instanceId: String!, newName: String!): AWSJSON
		@aws_cognito_user_pools
	createServer(input: CreateServerInput!): AWSJSON
		@aws_cognito_user_pools
	putLogAudit(input: LogAuditInput!): LogAudit
		@aws_iam @aws_cognito_user_pools
	updateUserRole(input: UpdateUserRoleInput!): UserMembership
		@aws_cognito_user_pools
	removeUserFromServer(userId: String!, serverId: String!): AWSJSON
		@aws_cognito_user_pools
}

type Query {
	ec2Discovery: [ServerInfo]  
		@aws_cognito_user_pools
	getServerConfig(id: String!): ServerConfig
		@aws_cognito_user_pools
	getServerUsers(instanceId: String!): [ServerUsers]
		@aws_cognito_user_pools
	getAdminUsers: [ServerUsers]
		@aws_cognito_user_pools
	searchUserByEmail(email: AWSEmail!): ServerUsers
		@aws_cognito_user_pools
	getLogAudit(id: String!): [LogAudit]
		@aws_cognito_user_pools  
	getServerLogs(instanceId: String!, lines: Int): ServerLogs
		@aws_cognito_user_pools
	# Query for historical server metrics
	ec2MetricsHandler(id: String!): ServerMetric
		@aws_cognito_user_pools
}

type Subscription {
	onPutServerMetric(id: String!): ServerMetric  
		@aws_subscribe(mutations: ["putServerMetric"])
@aws_cognito_user_pools
@aws_iam

	onChangeState: ServerInfo
		@aws_subscribe(mutations: ["changeServerState"])  
@aws_cognito_user_pools
@aws_iam

	onPutec2ActionValidatorStatus(id: String!): ec2ActionValidatorStatus
		@aws_subscribe(mutations: ["putec2ActionValidatorStatus"])
@aws_cognito_user_pools
@aws_iam

}