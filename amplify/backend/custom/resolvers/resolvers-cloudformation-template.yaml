AWSTemplateFormatVersion: '2010-09-09'
Parameters:
  env:
    Type: String
  apiminecraftserverdashbGraphQLAPIIdOutput:
    Type: String
    Description: >-
      Input parameter describing GraphQLAPIIdOutput attribute for
      api/minecraftserverdashb resource
  apiminecraftserverdashbGraphQLAPIEndpointOutput:
    Type: String
    Description: >-
      Input parameter describing GraphQLAPIEndpointOutput attribute for
      api/minecraftserverdashb resource
Resources:
  ChangeServerStateDataSource:
    Type: AWS::AppSync::DataSource
    Properties:
      ApiId:
        Ref: apiminecraftserverdashbGraphQLAPIIdOutput
      Name: ChangeServerStateDataSource
      Type: NONE
  ChangeServerStateResolver:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Ref: apiminecraftserverdashbGraphQLAPIIdOutput
      TypeName: Mutation
      FieldName: changeServerState
      Kind: UNIT
      DataSourceName:
        Fn::GetAtt:
          - ChangeServerStateDataSource
          - Name
      RequestMappingTemplate: |
        {
          "version" : "2017-02-28",
          "payload": { 
              "id": $util.toJson($context.arguments.input.id),
              "name": $util.toJson($context.arguments.input.name),
              "type": $util.toJson($context.arguments.input.type),
              "userEmail": $util.toJson($context.arguments.input.userEmail),
              "state": $util.toJson($context.arguments.input.state),
              "vCpus": $util.toJson($context.arguments.input.vCpus),
              "memSize": $util.toJson($context.arguments.input.memSize),
              "diskSize": $util.toJson($context.arguments.input.diskSize),
              "launchTime": $util.toJson($context.arguments.input.launchTime),
              "publicIp": $util.toJson($context.arguments.input.publicIp),
              "instanceStatus": $util.toJson($context.arguments.input.instanceStatus),
              "systemStatus": $util.toJson($context.arguments.input.systemStatus),
          }
        }
      ResponseMappingTemplate: $utils.toJson($ctx.result)
  PutServerMetricDataSource:
    Type: AWS::AppSync::DataSource
    Properties:
      ApiId:
        Ref: apiminecraftserverdashbGraphQLAPIIdOutput
      Name: PutServerMetricDataSource
      Type: NONE
  PutServerMetricStateResolver:
    Type: AWS::AppSync::Resolver
    Properties:
      ApiId:
        Ref: apiminecraftserverdashbGraphQLAPIIdOutput
      TypeName: Mutation
      FieldName: putServerMetric
      Kind: UNIT
      DataSourceName:
        Fn::GetAtt:
          - PutServerMetricDataSource
          - Name
      RequestMappingTemplate: |
        {
          "version" : "2017-02-28",
          "payload": { 
              "id": $util.toJson($context.arguments.input.id),
              "cpuStats": $util.toJson($context.arguments.input.cpuStats),
              "networkStats": $util.toJson($context.arguments.input.networkStats),
              "activeUsers": $util.toJson($context.arguments.input.activeUsers)
          }
        }
      ResponseMappingTemplate: $utils.toJson($ctx.result)

  AppSyncUrlParameter:
    Type: AWS::SSM::Parameter
    Properties:
      Name: /amplify/minecraftserverdashboard/appsyncurl
      Type: String
      Value: !Ref apiminecraftserverdashbGraphQLAPIEndpointOutput
      Description: Minecraft Server Dashboard Appsync Endpoint.

Outputs:
Description: >-
  {"createdOn":"Mac","createdBy":"Amplify","createdWith":"8.0.1","stackType":"custom-customCloudformation","metadata":{}}
